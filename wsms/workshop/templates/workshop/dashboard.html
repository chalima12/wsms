<!-- workshop/templates/workshop/user_dashboard.html -->

{% extends 'workshop/base1.html' %}

{% block content %}
    <div class="container">
        <h1>User Dashboard</h1>
        <div class="row">
            <div class="col-lg-3 col-6">
                <!-- small box -->
                <div class="small-box bg-info">
                    <div class="inner">
                        <h3>{{ item_count }}</h3>
                        <p>Items</p>
                    </div>
                    <div class="icon">
                        <i class="ion ion-bag"></i>
                    </div>
                </div>
            </div>
            <!-- ./col -->
            <div class="col-lg-3 col-6">
                <!-- small box -->
                <div class="small-box bg-success">
                    <div class="inner">
                        <h3>{{ section_count }}<sup style="font-size: 20px"></sup></h3>
                        <p>Sections</p>
                    </div>
                    <div class="icon">
                        <i class="ion ion-stats-bars"></i>
                    </div>
                </div>
            </div>
            <!-- ./col -->
            <div class="col-lg-3 col-6">
                <!-- small box -->
                <div class="small-box bg-warning">
                    <div class="inner">
                        <h3>{{ user_count }}</h3>
                        <p>Users</p>
                    </div>
                    <div class="icon">
                        <i class="ion ion-person-add"></i>
                    </div>
                </div>
            </div>
            <!-- ./col -->
            <div class="col-lg-3 col-6">
                <!-- small box -->
                <div class="small-box bg-danger">
                    <div class="inner">
                        <h3>{{ component_count }}</h3>
                        <p>Components</p>
                    </div>
                    <div class="icon">
                        <i class="ion ion-pie-graph"></i>
                    </div>
                </div>
            </div>
            <!-- ./col -->
        </div>

        <!-- Item Status Chart -->
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            Item Status
                            <button class="btn btn-link float-right" onclick="toggleChart('itemStatusChart', 'itemStatusIcon')">
                                <i id="itemStatusIcon" class="fa fa-minus"></i>
                            </button>
                        </h3>
                    </div>
                    <div class="card-body">
                        <canvas id="itemStatusCanvas" width="200" height="200"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Type Chart -->
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            User Type
                            <button class="btn btn-link float-right" onclick="toggleChart('userTypeChart', 'userTypeIcon')">
                                <i id="userTypeIcon" class="fa fa-minus"></i>
                            </button>
                        </h3>
                    </div>
                    <div class="card-body">
                        <canvas id="userTypeCanvas" width="200" height="200"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section Item Chart -->
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            Items per Section and Status
                            <button class="btn btn-link float-right" onclick="toggleChart('sectionItemChart', 'sectionItemIcon')">
                                <i id="sectionItemIcon" class="fa fa-minus"></i>
                            </button>
                        </h3>
                    </div>
                    <div class="card-body">
                        <canvas id="sectionItemCanvas" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

   
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Sample data for the charts
    var itemStatusData = {
        labels: ['On Progress','Completed' ,'Pending'],
        datasets: [{
            data: [{% for status_count in item_status_counts %}{{ status_count.count }},{% endfor %}],
            backgroundColor: [
                ' rgb(255, 255, 1) ',
                'rgba(0, 255, 0, 1)',
                'rgba(255, 0, 0, 1)',
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(75, 192, 192, 1)',
            ],
            borderWidth: 1,
        }],
    };

    var userTypeData = {
        labels: [{% for user_type_count in user_type_counts %}"{{ user_type_count.user_type }}",{% endfor %}],
        datasets: [{
            data: [{% for user_type_count in user_type_counts %}{{ user_type_count.count }},{% endfor %}],
            backgroundColor: [
                'rgba(255, 99, 132, 0.5)',
                'rgba(54, 162, 235, 0.5)',
                'rgba(255, 205, 86, 0.5)',
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 205, 86, 1)',
            ],
            borderWidth: 1,
        }],
    };

    var sectionItemData = {
        labels: [{% for section_item_count in section_item_counts %}"{{ section_item_count.name }}",{% endfor %}],
        datasets: [
            {
                label: 'Total Items',
                data: [{% for section_item_count in section_item_counts %}{{ section_item_count.item_count }},{% endfor %}],
                backgroundColor: 'rgba(75, 192, 192, 0.5)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1,
            },
            {
                label: 'Pending Items',
                data: [{% for section_item_count in section_item_counts %}{{ section_item_count.pending_count }},{% endfor %}],
                backgroundColor: 'rgba(255, 0, 0, 1)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1,
            },
            {
                label: 'On Progress Items',
                data: [{% for section_item_count in section_item_counts %}{{ section_item_count.on_progress_count }},{% endfor %}],
                backgroundColor: ' rgb(255, 255, 1) ',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1,
            },
            {
                label: 'Completed Items',
                data: [{% for section_item_count in section_item_counts %}{{ section_item_count.completed_count }},{% endfor %}],
                backgroundColor: 'rgba(0, 255, 0, 1)',
                borderColor: 'rgba(255, 205, 86, 1)',
                borderWidth: 1,
            },
        ],
    };

    var itemStatusCtx = document.getElementById('itemStatusCanvas').getContext('2d');
    var itemStatusChart = new Chart(itemStatusCtx, {
        type: 'pie',
        data: itemStatusData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            onClick: function (event, elements) {
                handleDismissal('Item Status', elements);
            },
        },
    });

    // User Type Chart
    var userTypeCtx = document.getElementById('userTypeCanvas').getContext('2d');
    var userTypeChart = new Chart(userTypeCtx, {
        type: 'doughnut',
        data: userTypeData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            onClick: function (event, elements) {
                handleDismissal('User Type', elements);
            },
        },
    });

    // Section Item Chart
    var sectionItemCtx = document.getElementById('sectionItemCanvas').getContext('2d');
    var sectionItemChart = new Chart(sectionItemCtx, {
        type: 'bar',
        data: sectionItemData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    stacked: false,
                },
                y: {
                    stacked: false,
                },
            },
            onClick: function (event, elements) {
                handleDismissal('Section Item', elements);
            },
        },
    });



        var itemStatusChart = new Chart(document.getElementById('itemStatusCanvas').getContext('2d'), {
            type: 'pie',
            data: itemStatusData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
            },
        });

        var userTypeChart = new Chart(document.getElementById('userTypeCanvas').getContext('2d'), {
            type: 'doughnut',
            data: userTypeData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
            },
        });

        var sectionItemChart = new Chart(document.getElementById('sectionItemCanvas').getContext('2d'), {
            type: 'bar',
            data: sectionItemData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { stacked: false },
                    y: { stacked: false },
                },
            },
        });

        function toggleChart(chartName, iconId) {
            var chart = window[chartName];
            if (chart) {
                var chartCanvas = chart.canvas;
                var icon = document.getElementById(iconId);
                if (chartCanvas.style.display === 'none') {
                    chartCanvas.style.display = 'block';
                    icon.className = 'fa fa-minus';
                } else {
                    chartCanvas.style.display = 'none';
                    icon.className = 'fa fa-plus';
                }
            }
        }
    </script>
{% endblock %}
