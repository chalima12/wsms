
{% extends "./base1.html" %}
  {% include 'workshop/Add_assignment.html' %}
  
  {% block title %}
    <title>Item List </title>
  {% endblock title %} 
    



  
{% block content %}




    <!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
  <div class="container mt-1"> 

{% if user.add_item %}
  
<a class="btn btn-warning" href="{% url 'workshop:create-item' %}">
  
  <span class="fa fa-plus">
   &nbsp;&nbsp; Add Item
  </span>
</a>
{% endif %}
       
<div class="container">
 <!-- Your HTML template file -->
<!-- Your HTML template file -->
{% if messages %}
    {% for message in messages %}
        <div class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'warning' %}alert-warning{% endif %} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    {% endfor %}
{% endif %}

</div> 

    </div>

            <div class="card m-3">
              <div class="card-header">
                <h2 class="container mx-5 card-title">List of Items</h2>
              </div>
              <!-- /.card-header -->
              <div class="card-body">
                <table id="example1" class="table table-bordered table-striped">
                
                      <thead class="dataTables_info">
                        <tr>
                          <th>ID</th>
                          <th>Received Date</th>
                          <th>Stock Id</th>
                          <th>Serial Number</th>
                          <th>Status</th>
                          <th>Acceped</th>
                          
                          {% if user.delete_item %}
                          <th>Action</th>  
                          {% endif %}
                            
                          
                        </tr>
                      </thead>
                      <tbody>
                       
                        {% for data in items %}
                        <tr>
                          <td>{{data.id}}</td>
                        <td> {{data.received_date}}</td>
                        <td>{{data.stock_id}}</td>
                        <td>{{data.Serial_no}}</td>
                        <td>{{data.status}}</td>
                        <td>{{data.is_accepted}}</td>
                        
                        {% if user.delete_item %}
                          
                        <td >
                          <a style='border-radius:10%'  class="btn btn-info btn-sm btn " 
                        href='{% url "workshop:item_detail" data.id%}' > <span class="fas fa-eye ">Item</span></a>
                        
                          {% if data.status == 'pending' %}
                          <a class='btn btn-secondary btn-sm' 
                           style='border-radius:10%' href="{% url 'workshop:create-assignment' data.id %}">
                          <span class="fa fa-address-book">
                          Assign
                          </span>
                          </a>
                          {% else %}
                          <a class='btn btn-secondary btn-sm btn disabled' style='border-radius:10%' href="#">
                          <span class="fa fa-address-book">
                          Assigned
                          </span>
                          </a>
                          {% endif %}
                      
                          
                        <a style='border-radius:10%' class="btn btn-danger btn-sm" href="javascript:void(0)"
                        data-toggle="modal"
                        class="confirm-accept"
                        data-url="{% url 'workshop:item_delete' data.id %}"

                        data-target="#acceptItemModal"
                        data-message="Are you Sure to delete {{data.Serial_no}}  ?">
                        <i class="far fa-trash-alt"></i>
                        <span>Delete</span></a>
                        </td>
                        {% endif %}
                          
                        </tr>
                        {% endfor %}
                        
                      </tbody>
                    </table>
              </div>
              <!-- /.card-body -->
            </div>
            <!-- /.card -->
          </div>
          <!-- /.col -->
        </div>
        <!-- /.row -->
      </div>
    </div>  
      {% if messages.warning %}
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
      <script>
        // create a modal popup with the warning message
        Swal.fire(
          icon: 'warning',
          title: 'Warning',
          text: '{{ messages.warning }}',
          confirmButtonText: 'Close'
        );
      </script>
    {% endif %}
    <!-- Add this script at the end of your HTML file or in a separate JavaScript file -->
<script>
  // Use JavaScript to periodically check for the presence of the success message
  setInterval(function () {
      var successMessage = document.querySelector('.alert-success');

      if (successMessage) {
          // Update the navbar content here
          // You can use DOM manipulation or make an AJAX request to get updated data
          // For simplicity, let's assume the updated data is available in a JavaScript variable 'userData'
          updateNavbar(userData);

          // Remove the success message
          successMessage.remove();
      }
  }, 1000);  // Check every 1 second (adjust the interval as needed)

  function updateNavbar(userData) {
      // Update the navbar content based on the userData
      // Use DOM manipulation or any other method that suits your implementation
      // For example, you can update the user's name and profile picture
      document.querySelector('.profile-user-name').innerText = userData.user_name;

      if (userData.profile_picture_url) {
          document.querySelector('.profile-user-img').src = userData.profile_picture_url;
      }
  }
</script>

{% endblock content %}
    

